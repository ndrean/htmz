# Debian-based container with glibc
FROM debian:bookworm-slim

RUN apt-get update && apt-get install -y \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy the pre-built binary (build with: zig build -Dtarget=aarch64-linux-gnu -Doptimize=ReleaseFast)
COPY zig-out/bin/htmz ./htmz

# Copy shared library
COPY .zig-cache/o/*/libfacil.io.so /usr/lib/

# Copy public assets
COPY public/ ./public/

# Set environment
ENV PORT=8080

# Expose port
EXPOSE 8080

# Create non-root user for security
RUN adduser --disabled-password --gecos '' appuser && \
    chown -R appuser:appuser /app
USER appuser

CMD ["/app/htmz"]